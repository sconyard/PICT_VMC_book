<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Unofficial documentation for VMware Cloud">
  <meta name="generator" content="Hugo 0.63.2" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span title="Getting Started" onclick="leftNavClick(this)">Getting Started</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a title="Activate Services" href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a title="Billing" href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a title="Manage Users" href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span title="HCX" onclick="leftNavClick(this)">HCX</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span title="A Technical Overview" onclick="leftNavClick(this)">A Technical Overview</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a title="Planning" href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a title="Preparation" href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a title="Testing" href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a title="Migration" href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a title="Activate" href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a title="Install" href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a title="Network Extension" href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a title="Workload Migration" href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span title="VMware Cloud on AWS" onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a title="A Technical Overview" href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span title="On-Boarding" onclick="leftNavClick(this)">On-Boarding</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a title="Requirements" href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a title="Term Subscription" href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a title="SDDC" href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Compute" onclick="leftNavClick(this)">Compute</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/compute/" >Index</a></li>
        <li ><a title="vCenter Architecture" href="/vmcbook/guides/vmc-aws/compute/vcenter-architecture/" >vCenter Architecture</a></li><li ><a title="Stretched Clusters" href="/vmcbook/guides/vmc-aws/compute/stretched-cluster/" >Stretched Clusters</a></li><li ><a title="EDRS" href="/vmcbook/guides/vmc-aws/compute/edrs/" >EDRS</a></li>
      </ul></li><li class="open parent">
        <span title="Storage" onclick="leftNavClick(this)">Storage</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/storage/" >Index</a></li>
        <li class="open parent"><a title="vSAN Architecture" href="/vmcbook/guides/vmc-aws/storage/vsan-architecture/" class="active">vSAN Architecture</a></li>
      </ul></li><li >
        <span title="Networking" onclick="leftNavClick(this)">Networking</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a title="SDDC Network Architecture" href="/vmcbook/guides/vmc-aws/networking/sddc-network-architecture/" >SDDC Network Architecture</a></li><li ><a title="DNS and DHCP" href="/vmcbook/guides/vmc-aws/networking/dns-and-dhcp/" >DNS and DHCP</a></li><li >
        <span title="IPSec VPN" onclick="leftNavClick(this)">IPSec VPN</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li ><a title="Configure" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" >Configure</a></li><li ><a title="Troubleshoot" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a title="Sample Configs" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Direct Connect" onclick="leftNavClick(this)">Direct Connect</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span title="Index" onclick="leftNavClick(this)">Index</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a title="Configure" href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a title="Network Segments" href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Network Security" onclick="leftNavClick(this)">Network Security</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a title="Services" href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a title="Groups" href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a title="Gateway Firewall" href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a title="DFW" href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a title="NAT" href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Validated Designs" onclick="leftNavClick(this)">Validated Designs</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span title="Network" onclick="leftNavClick(this)">Network</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a title="Hub-and-Spoke Designs" href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a title="Transit Gateway" href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Appendix" onclick="leftNavClick(this)">Appendix</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/appendix/" >Index</a></li>
        <li ><a title="Instance Types" href="/vmcbook/guides/vmc-aws/appendix/instance-types/" >Instance Types</a></li><li ><a title="Management Footprint" href="/vmcbook/guides/vmc-aws/appendix/management-footprint/" >Management Footprint</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Site" onclick="leftNavClick(this)">Site</span><ul>
        <li><a  title="Index" href="/vmcbook/site/" >Index</a></li>
        <li ><a title="Authoring Guide" href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a title="Information" href="/vmcbook/site/information/" >Information</a></li><li ><a title="Links" href="/vmcbook/site/links/" >Links</a></li><li ><a title="Resources" href="/vmcbook/site/resources/" >Resources</a></li><li ><a title="Color Scheme" href="/vmcbook/site/color-scheme/" >Color Scheme</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#storage-types">Storage Types</a>
      <ul>
        <li><a href="#native-nvme-based-storage">Native NVMe-Based Storage</a></li>
        <li><a href="#ebs-backed-storage">EBS-Backed Storage</a></li>
        <li><a href="#nfs">NFS</a></li>
      </ul>
    </li>
    <li><a href="#the-vcenter-base-cluster">The vCenter Base Cluster</a></li>
    <li><a href="#vsan-slack-space-requirements">vSAN Slack Space Requirements</a></li>
    <li><a href="#deduplication-and-compression">Deduplication and Compression</a></li>
    <li><a href="#scsi-unmap">SCSI Unmap</a></li>
    <li><a href="#encryption">Encryption</a></li>
    <li><a href="#storage-policies">Storage Policies</a></li>
  </ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <h1>VMware Cloud on AWS</h1><h2>Storage:&nbspvSAN Architecture</h2></header>

    <h2 id="overview">Overview</h2>
<p>The SDDC utilizes vSAN as its mechanism for providing distributed storage within each Cluster of the SDDC. While the underlying storage for a vSAN Datastore depends on the instance type of the hosts within the Cluster, the overall behavior of vSAN is consistent throughout the SDDC. The details of the vSAN architecture are detailed below.</p>
<h2 id="storage-types">Storage Types</h2>
<h3 id="native-nvme-based-storage">Native NVMe-Based Storage</h3>
<p>This type of storage is housed directly within the hosts of the SDDC and has a fixed size depending on the host instance type. For each host which is added to a Cluster, the overall storage pool will increase. NVMe storage is the most performant of the available storage types.</p>
<h3 id="ebs-backed-storage">EBS-Backed Storage</h3>
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AmazonEBS.html">EBS</a> has been made available to for certain host instance types. As with NVMe storage, each additional host added to a Cluster will contributed to the available storage pool. Unlike NVMe, the amount of EBS-backed storage is configurable. EBS-backed storage is not as performant as NVMe storage, but offers greater overall capacity.</p>
<h3 id="nfs">NFS</h3>
<p>NFS storage is currently offered only through certain VMware partners.</p>
<h2 id="the-vcenter-base-cluster">The vCenter Base Cluster</h2>
<p>Within the base Cluster of the SDDC, vSAN has been modified to present two logical Datastores from the same underlying physical storage: one for management appliances and the other for end-user workloads. It is important to point out that this separation exists purely as a means of enforcing permissions on the storage for management appliances. Since management appliances will not exist outside of the base cluster, this concept of dual logical Datastores will not exist in any other Clusters.</p>
<section  class="callout" ><header>Key Takeaways</header><ul>
<li>The logical Datastores reflect the same underlying pool of capacity. Do not mistake them for independent sets of storage.</li>
<li>The free space, used space, and total capacity numbers will be identical between the two logical Datastores.</li>
<li>You must consider management appliance storage footprints within the base cluster when sizing an SDDC.</li>
</ul>
</section>

<h2 id="vsan-slack-space-requirements">vSAN Slack Space Requirements</h2>
<p>vSAN requires that a certain percentage of raw storage within a Datastore be reserved as &ldquo;slack&rdquo; space. This reserved space is used for operations such as deduplication, object re-balancing, and for recovering from hardware outages within the underlying pool of storage capacity. The current official recommendation is to maintain a 30% buffer for slack space.</p>
<p>As part of its <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/support/vmw-cloud-aws-service-level-agreement.pdf.">service level agreement</a> with customers, VMware will ensure the health of the SDDC by enforcing this slack space requirement using storage-based <a href="https://dspinhirne.github.io/vmcbook/guides/vmc-aws/compute/edrs/">EDRS</a> scale-up whenever necessary. A notification will be sent out to the Org Owner of the SDDC whenever the 30% threshold is exceeded and EDRS will automatically scale-up the SDDC if available slack space drops to 25% or less.</p>
<h2 id="deduplication-and-compression">Deduplication and Compression</h2>
<p><a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-3D2D80CC-444E-454E-9B8B-25C3F620EFED.html">Deduplication and Compression</a> is designed to optimize storage by reducing the amount of space required to store data within the Datastore. These features are enabled on vSAN Datastores by default and cannot be disabled. Although highly dependent on the type of data being stored, a 2x reduction is a good general guideline for most deployments.</p>
<p>It should be noted that for performance reasons, deduplication has been disabled for EBS-backed vSAN Datastores.</p>
<h2 id="scsi-unmap">SCSI Unmap</h2>
<p>The vSAN SCSI <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-C75E80AE-2DA8-4314-98E5-B7F8CE98E1BF.html">Unmap</a> feature is currently not supported.</p>
<h2 id="encryption">Encryption</h2>
<p>vSAN implements <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-F3B2714F-3406-48E7-AC2D-3677355C94D3.html">encryption</a> at <a href="https://en.wikipedia.org/wiki/Data_at_rest">rest</a> using the AWS <a href="https://docs.aws.amazon.com/kms/latest/developerguide/overview.html">KMS</a> service. Although much of the functionality behind vSAN encryption is automated, it is worth understanding the key components and which of them may be customized.</p>
<p>The components of encryption are as follows:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#master_keys">Customer Master Keys</a> (CMK) - This is the master key which is used to encrypt all other keys used by vSAN. It is controlled and managed by AWS and not may not be updated. One CMK is required per Cluster.</li>
<li><a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-37F9636A-7481-4486-AAA9-E0A1A49343A1.html">Key Encryption Key</a> (KEK) - This key is used by vSAN to encrypt DEKs and may be updated through the vCenter UI (referred to as a shallow rekey). One KEK is required per Cluster.</li>
<li><a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-37F9636A-7481-4486-AAA9-E0A1A49343A1.html">Disk Encryption Key</a> (DEK) - This key is used to encrypt disk data and may not be updated. One DEK is required per disk in vSAN.</li>
</ul>
<h2 id="storage-policies">Storage Policies</h2>
<p>Total usable storage within an SDDC is largely a function of the vSAN storage policy which is applied to objects within your SDDC. The following are the most common factors to consider when defining a storage policy:</p>
<ul>
<li>Site Disaster Tolerance - Used with stretched-cluster SDDCs to define data replication policy between Availability Zones. This is not applicable to standard Clusters.</li>
<li>Failures to Tolerate (FTT) - This defines the number of host or disk failures to tolerate. In other words, how many devices may fail before data loss occurs.</li>
<li>Fault Tolerance Method (FTM) - This defines the type of data replication used: mirroring or <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-AD408FA8-5898-4541-9F82-FE72E6CD6227.html#GUID-AD408FA8-5898-4541-9F82-FE72E6CD6227">erasure coding</a>. Mirroring is typically considered to have higher read performance, while erasure-coding tends to use less storage space.</li>
</ul>
<p>The options chosen when configuring the policy will impact the total available storage of the Datastore.</p>
<figure   ><table>
<thead>
<tr>
<th>FTT</th>
<th>FTM</th>
<th>Hosts Required</th>
<th>Required Capacity</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>RAID1</td>
<td>3</td>
<td>2X</td>
</tr>
<tr>
<td>1</td>
<td>RAID5</td>
<td>4</td>
<td>1.33X</td>
</tr>
<tr>
<td>2</td>
<td>RAID1</td>
<td>4</td>
<td>3X</td>
</tr>
<tr>
<td>2</td>
<td>RAID6</td>
<td>6</td>
<td>1.5X</td>
</tr>
<tr>
<td>3</td>
<td>RAID1</td>
<td>7</td>
<td>4X</td>
</tr>
</tbody>
</table><figcaption>vSAN FTT/FTM Configurations</figcaption></figure>

<p>Each combination requires a certain minimum number of hosts and has an associated &ldquo;cost&rdquo; in terms of storage overhead required to implement. For example, we can see that the first policy in the table requires twice the storage space to implement the policy. This is because RAID1 mirroring is duplicated each storage object twice in order to implement the FTT value of 1.</p>
<p>It is important to keep in mind that storage policies may be applied both to entire VMs or to individual disks within a VM. Because of granularity in which policies are applied, it is possible to have multiple policies applied to workloads within the SDDC. However, vSAN requires a default policy to exist which is applied to VMs that do not have an explicit policy set. A default policy for the SDDC is created automatically by VMware, at the time of provisioning, based on the number of hosts within the vCenter base Cluster.</p>
    
    <footer class="content-footer"><div>
          Written by <a href="/vmcbook/author/dspinhirne/">Dustin Spinhirne</a>
          </div><div>
          Originally published Friday, Jan 24, 2020.
          </div></footer>

  </article></main>
    </article>
    
  </body>
</html>
