<!DOCTYPE html>
<html>

<head>
  <title>VMware Cloud Knowledge</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Unofficial documentation for VMware Cloud">
  <meta name="generator" content="Hugo 0.63.2" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://dspinhirne.github.io/vmcbook/main.css">
  <script type="text/javascript" src="https://dspinhirne.github.io/vmcbook/main.js"></script>
</head>

  <body>
    
    <header class="main-header">
      <div>
        <a href="https://cloud.vmware.com"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/vm.svg"></a>
      </div>
      <div><a href="https://dspinhirne.github.io/vmcbook/">VMware Cloud Knowledge</a></div>
      <div>
        <a href="https://github.com/dspinhirne/vmcbook" class="github-link"><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/resources/images/github.svg"><span>Star</span></a>
      </div>
    </header>

    <article class="main-article">
      <nav class="left-nav">
        <ul class="top-level"><li >
        <span title="Getting Started" onclick="leftNavClick(this)">Getting Started</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/getting-started/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/getting-started/introduction/" >Introduction</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/getting-started/howto/" >Index</a></li>
        <li ><a title="Activate Services" href="/vmcbook/guides/getting-started/howto/activate-services/" >Activate Services</a></li><li ><a title="Billing" href="/vmcbook/guides/getting-started/howto/billing/" >Billing</a></li><li ><a title="Manage Users" href="/vmcbook/guides/getting-started/howto/manage-users/" >Manage Users</a></li>
      </ul></li>
      </ul></li><li >
        <span title="HCX" onclick="leftNavClick(this)">HCX</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/" >Index</a></li>
        <li >
        <span title="A Technical Overview" onclick="leftNavClick(this)">A Technical Overview</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/a-technical-overview/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/hcx/a-technical-overview/introduction/" >Introduction</a></li><li ><a title="Planning" href="/vmcbook/guides/hcx/a-technical-overview/planning/" >Planning</a></li><li ><a title="Preparation" href="/vmcbook/guides/hcx/a-technical-overview/preparation/" >Preparation</a></li><li ><a title="Testing" href="/vmcbook/guides/hcx/a-technical-overview/testing/" >Testing</a></li><li ><a title="Migration" href="/vmcbook/guides/hcx/a-technical-overview/migration/" >Migration</a></li>
      </ul></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/hcx/howto/" >Index</a></li>
        <li ><a title="Activate" href="/vmcbook/guides/hcx/howto/activate/" >Activate</a></li><li ><a title="Install" href="/vmcbook/guides/hcx/howto/install/" >Install</a></li><li ><a title="Network Extension" href="/vmcbook/guides/hcx/howto/network-extension/" >Network Extension</a></li><li ><a title="Workload Migration" href="/vmcbook/guides/hcx/howto/workload-migration/" >Workload Migration</a></li>
      </ul></li>
      </ul></li><li class="open parent">
        <span title="VMware Cloud on AWS" onclick="leftNavClick(this)">VMware Cloud on AWS</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/" >Index</a></li>
        <li ><a title="A Technical Overview" href="/vmcbook/guides/vmc-aws/a-technical-overview/" >A Technical Overview</a></li><li >
        <span title="On-Boarding" onclick="leftNavClick(this)">On-Boarding</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/on-boarding/" >Index</a></li>
        <li ><a title="Introduction" href="/vmcbook/guides/vmc-aws/on-boarding/introduction/" >Introduction</a></li><li ><a title="Requirements" href="/vmcbook/guides/vmc-aws/on-boarding/requirements/" >Requirements</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/on-boarding/howto/" >Index</a></li>
        <li ><a title="Term Subscription" href="/vmcbook/guides/vmc-aws/on-boarding/howto/term-subscription/" >Term Subscription</a></li><li ><a title="SDDC" href="/vmcbook/guides/vmc-aws/on-boarding/howto/sddc/" >SDDC</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Compute" onclick="leftNavClick(this)">Compute</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/compute/" >Index</a></li>
        <li ><a title="vCenter Architecture" href="/vmcbook/guides/vmc-aws/compute/vcenter-architecture/" >vCenter Architecture</a></li><li ><a title="Stretched Clusters" href="/vmcbook/guides/vmc-aws/compute/stretched-cluster/" >Stretched Clusters</a></li><li ><a title="EDRS" href="/vmcbook/guides/vmc-aws/compute/edrs/" >EDRS</a></li>
      </ul></li><li >
        <span title="Storage" onclick="leftNavClick(this)">Storage</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/storage/" >Index</a></li>
        <li ><a title="vSAN Architecture" href="/vmcbook/guides/vmc-aws/storage/vsan-architecture/" >vSAN Architecture</a></li>
      </ul></li><li class="open parent">
        <span title="Networking" onclick="leftNavClick(this)">Networking</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/" >Index</a></li>
        <li ><a title="SDDC Network Architecture" href="/vmcbook/guides/vmc-aws/networking/sddc-network-architecture/" >SDDC Network Architecture</a></li><li ><a title="DNS and DHCP" href="/vmcbook/guides/vmc-aws/networking/dns-and-dhcp/" >DNS and DHCP</a></li><li class="open parent">
        <span title="IPSec VPN" onclick="leftNavClick(this)">IPSec VPN</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/concepts/" >Concepts</a></li><li class="open parent">
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/" >Index</a></li>
        <li class="open parent"><a title="Configure" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/configure/" class="active">Configure</a></li><li ><a title="Troubleshoot" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/troubleshoot/" >Troubleshoot</a></li><li ><a title="Sample Configs" href="/vmcbook/guides/vmc-aws/networking/ipsec-vpn/howto/sample-configs/" >Sample Configs</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Direct Connect" onclick="leftNavClick(this)">Direct Connect</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/direct-connect/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/networking/direct-connect/concepts/" >Concepts</a></li><li >
        <span title="Index" onclick="leftNavClick(this)">Index</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/" >Index</a></li>
        <li ><a title="Configure" href="/vmcbook/guides/vmc-aws/networking/direct-connect/howto/configure/" >Configure</a></li>
      </ul></li>
      </ul></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/networking/howto/" >Index</a></li>
        <li ><a title="Network Segments" href="/vmcbook/guides/vmc-aws/networking/howto/network-segments/" >Network Segments</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Network Security" onclick="leftNavClick(this)">Network Security</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/network-security/" >Index</a></li>
        <li ><a title="Concepts" href="/vmcbook/guides/vmc-aws/network-security/concepts/" >Concepts</a></li><li >
        <span title="HowTo" onclick="leftNavClick(this)">HowTo</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/network-security/howto/" >Index</a></li>
        <li ><a title="Services" href="/vmcbook/guides/vmc-aws/network-security/howto/services/" >Services</a></li><li ><a title="Groups" href="/vmcbook/guides/vmc-aws/network-security/howto/groups/" >Groups</a></li><li ><a title="Gateway Firewall" href="/vmcbook/guides/vmc-aws/network-security/howto/gateway-firewall/" >Gateway Firewall</a></li><li ><a title="DFW" href="/vmcbook/guides/vmc-aws/network-security/howto/dfw/" >DFW</a></li><li ><a title="NAT" href="/vmcbook/guides/vmc-aws/network-security/howto/nat/" >NAT</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Validated Designs" onclick="leftNavClick(this)">Validated Designs</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/validated-designs/" >Index</a></li>
        <li >
        <span title="Network" onclick="leftNavClick(this)">Network</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/validated-designs/network/" >Index</a></li>
        <li ><a title="Hub-and-Spoke Designs" href="/vmcbook/guides/vmc-aws/validated-designs/network/hub-and-spoke-designs/" >Hub-and-Spoke Designs</a></li><li ><a title="Transit Gateway" href="/vmcbook/guides/vmc-aws/validated-designs/network/transit-gateway/" >Transit Gateway</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Appendix" onclick="leftNavClick(this)">Appendix</span><ul>
        <li><a  title="Index" href="/vmcbook/guides/vmc-aws/appendix/" >Index</a></li>
        <li ><a title="Instance Types" href="/vmcbook/guides/vmc-aws/appendix/instance-types/" >Instance Types</a></li><li ><a title="Management Footprint" href="/vmcbook/guides/vmc-aws/appendix/management-footprint/" >Management Footprint</a></li>
      </ul></li>
      </ul></li><li >
        <span title="Site" onclick="leftNavClick(this)">Site</span><ul>
        <li><a  title="Index" href="/vmcbook/site/" >Index</a></li>
        <li ><a title="Authoring Guide" href="/vmcbook/site/authoring-guide/" >Authoring Guide</a></li><li ><a title="Information" href="/vmcbook/site/information/" >Information</a></li><li ><a title="Links" href="/vmcbook/site/links/" >Links</a></li><li ><a title="Resources" href="/vmcbook/site/resources/" >Resources</a></li><li ><a title="Color Scheme" href="/vmcbook/site/color-scheme/" >Color Scheme</a></li>
      </ul></li></ul>
      </nav>

      <main class="main-content">  <div class="TableOfContents">
    <h1>Page Contents</h1>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#configuration">Configuration</a></li>
    <li><a href="#policy-based-vpn">Policy-Based VPN</a></li>
    <li><a href="#route-based-vpn">Route-Based VPN</a></li>
    <li><a href="#important-tips">Important Tips</a></li>
  </ul>
</nav>
  </div>

  
  <article class="content with-toc">
    <header class="content-header">
      <h1>VMware Cloud on AWS</h1><h2>IPSec VPN HowTo:&nbspConfigure</h2></header>

    <h2 id="configuration">Configuration</h2>
<p>IPSec VPN is configured from within the <a href="https://vmc.vmware.com">VMC console</a> by navigating to the Network &amp; Security tab of the SDDC. The public VPN IP of the tier-0 edge is visible from the Overview page. The VPN item on the left-hand navigation will provide options for configuring both Policy and Route Based VPN.</p>

<figure><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-vpn.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-vpn.png" />
    </figure>

<h2 id="policy-based-vpn">Policy-Based VPN</h2>
<p>To create a policy-based VPN, click on the Policy Based menu item on the left-hand navigation pane and then click the Add VPN button.</p>

<figure><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-policy-based-vpn.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-policy-based-vpn.png" />
    </figure>

<p>The options are as follows:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Sub-Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td></td>
<td>Give the VPN a name which is meaningful to you.</td>
</tr>
<tr>
<td>Local IP Address</td>
<td></td>
<td>You may choose to bind the VPN to either the public or private IP of the edge gateway. For policy-based VPN, you should choose the public IP.</td>
</tr>
<tr>
<td>Remote Public IP</td>
<td></td>
<td>Provide the public IP of the remote VPN peer.</td>
</tr>
<tr>
<td>Remote Networks</td>
<td></td>
<td>Provide a comma-delimited list of networks which should be reachable by the SDDC via the VPN (e.g. 10.0.0.0/8).</td>
</tr>
<tr>
<td>Local Networks</td>
<td></td>
<td>Choose which networks within the SDDC should be reachable from the remote network via the VPN.</td>
</tr>
<tr>
<td>Advanced</td>
<td></td>
<td>These are the crypto settings for the VPN.</td>
</tr>
<tr>
<td></td>
<td>IKE Type</td>
<td>IKE version to use.</td>
</tr>
<tr>
<td></td>
<td>Tunnel Encryption</td>
<td>IKEv1 phase 2 settings.</td>
</tr>
<tr>
<td></td>
<td>Tunnel Digest Algorithm</td>
<td>IKEv2 IPSec Proposal settings.</td>
</tr>
<tr>
<td></td>
<td>IKE Encryption</td>
<td>IKEv1 phase 1 crypto settings.</td>
</tr>
<tr>
<td></td>
<td>IKE Digest Algorithm</td>
<td>IKEv2 crypto settings.</td>
</tr>
<tr>
<td></td>
<td>Perfect Forward Secrecy</td>
<td>Enable or disable PFS. It is recommended to enable.</td>
</tr>
<tr>
<td></td>
<td>Preshared Key</td>
<td>The secret key for the VPN.</td>
</tr>
<tr>
<td></td>
<td>Diffie Hellman</td>
<td>The <a href="https://en.wikipedia.org/wiki/Diffie-Hellman_key_exchange">DH</a> group to use.</td>
</tr>
</tbody>
</table>
<h2 id="route-based-vpn">Route-Based VPN</h2>
<p>To create a route-based VPN, click on the Route Based menu item on the left-hand navigation pane and then click the Add VPN button.</p>

<figure><img src="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-route-based-vpn.png" alt="https://media.githubusercontent.com/media/dspinhirne/vmcbook/master/guides/vmc-aws/networking/ipsec-vpn/howto/configure/vmc-console-route-based-vpn.png" />
    </figure>

<p>The first step you should complete is to set the SDDCs BGP <a href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)">ASN</a>. You should typically use an ASN from the designated private range (64512 - 65534).</p>
<p>Most of the fields are identical to the ones defined for policy-based VPN, however, there are a few differences:</p>
<ul>
<li>BGP Local IP/Prefix Length - The IP address to use for the SDDC side of the VTI (e.g. 169.254.255.1/30)</li>
<li>BGP Remote IP - The IP address of the remote end of the VTI (e.g. 169.254.255.2)</li>
<li>BGP Remote ASN - The ASN of the remote VPN peer.</li>
<li>Advanced BGP Parameters - A secret key for the BGP session.</li>
</ul>
<h2 id="important-tips">Important Tips</h2>
<p>Once you have configured and saved the VPN settings a link will appear which allows you to download the configuration for the VPN. Although this configuration is not vendor specific, the information is extremely helpful for configuring the remote VPN peer since it provides additional details not shown in the UI. Once you have downloaded the configuration, the next step will be to configure the remote end of the VPN.</p>
<p>The following are things to consider when configuring VPN:</p>
<ul>
<li>Most implementations of policy-based VPN will set up one Security Association per Remote/Local network pair, and 1 tunnel will be used for each. Your policies must match networks on both ends <strong>exactly</strong> in order for a given tunnel to come up. If one or more tunnels do not come up then the VPN will show as partially connected.</li>
<li>Crypto settings must match on both ends or the tunnel will fail to come up.</li>
<li>The most common problem with VPN is mismatching configurations. Triple check your settings if your VPN fails to come up. You can get an idea of where the mismatch is based on which phase of the VPN failed.</li>
<li>The second most common problem with VPN is firewall or NAT. If your VPN device is behind a no-NAT firewall then make sure that UDP 500 and IP protocol 50 are permitted inbound/outbound. If your device is behind a NAT firewall then make sure that UDP 500/4500 are permitted inbound/outbound (for NAT-t).</li>
</ul>
    
    <footer class="content-footer"><div>
          Originally published Tuesday, Oct 1, 2019.
          </div></footer>

  </article></main>
    </article>
    
  </body>
</html>
